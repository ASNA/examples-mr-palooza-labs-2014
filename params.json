{"name":"Examples-mr-palooza-labs-2014","tagline":"ASNApalooza 2014 lab registration with ILE RPG.","body":"ASNApalooza Lab Registration Mobile RPG app\r\n---\r\n\r\n\r\n>\r\n> This document is in progress!\r\n> \r\n\r\nThe ASNApalooza Lab Registration app was written with ASNA Mobile RPG and ILE RPG. \r\n\r\nIt serves as a testbed for a few concepts and ideas I've been working on with Mobile RPG and ILE RPG. Some of its techniques include:\r\n\r\n    \r\n  * It shows a way to manage RPG/display file logic without using function keys, response indicators, or the INFDS.  \r\n  * It uses embedded SQL exclusively in the RPG program. I chose this mostly because I wanted to create a quick environment for [creating database migrations](http://rails-guides.joefiorini.com/migrations.html) (a concept I first used several years ago with Ruby on Rails). Make no mistake, this is a poor man's database migration scheme at best, but it did save me time and trouble.\r\n  * How to send an email with a Mobile RPG app from the ASP.NET presentation layer.\r\n  * How to validate an email address in the presentation-layer code behind and pass the results of that validation on to the RPG program.\r\n  * How to collect values from the RPG program into session variables for later use by the presentation layer code behind (in this case, email contents). \r\n\r\nHere are the six record formats the lab registration program uses:\r\n\r\n![](http://i.imgur.com/tEYt6Nb.png)\r\n\r\n![](http://i.imgur.com/BZ5S70i.png)\r\n\r\n![](http://i.imgur.com/HEhv9HC.png)\r\n\r\n![](http://i.imgur.com/zdYa5HD.png)\r\n\r\n![](http://i.imgur.com/uKgbM7z.png)\r\n\r\n![](http://i.imgur.com/3CThK00.png)\r\n\r\n### Function keys be gone!\r\n    \r\nThis program uses some interesting conventions to control program flow. My goal was to be able to write the program logic linking the UI to the RPG program without any function keys, response indicators, or using the INFDS. \r\n\r\nTo understand how the program manages this, take a look at the (substantially) abridged MR record format below.\r\n\r\nEach record format in the Palooza Lab registration program defines three things: \r\n  1. The CursorField attribute is defined as `CAction` in the record format description. \r\n  2. An input/output field named CAction is declared, as defined in the previous bullet. This is a none-display field. \r\n  3. An input-only field named CFormat is declared and its value set to the alias of its parent record format. This is a non-display field. \r\n\r\nAll DdsButtons in the app assign a value to the `FieldName` property. This value specifies an action that the RPG program should perform when the button is tapped. This property is designed to work with the `CAction` field to tell the RPG the field name containing the name of the field where the cursor was located when the record format was returned to the RPG program. \r\n\r\nWith a little trial and error, though, I learned that that `FieldName` property is really a little more powerful that it first seems. When a DDsButton defines a `FieldName` value, that property's value is returned to the RPG program in the `CAction` field. The program isn't using this value for anything to do with field names! Rather, it it is using to know what action was requested. In the case of the buttons below, one requests a `REGISTER` action, and one requests a `RETURNING` action, and one requests an `END` action.     \r\n\r\nNote also that all of the buttons are associated with the F3 `AidKey`. All of the buttons in the program are associated with F3! That's because they each need an `AidKey` to report input to the RPG program, but I don't care which key was pressed. The program uses the `CAction` field to see what action is required.\r\n\r\nRemember that the `FieldName` property, in this case, isn't a field name! It's the name of an action to perform. You'll notice that I've defined the `CAction` field as being 32 characters long. This means the `FieldName` property can be long enough to be meaningful. When I first started doing this, I assumed the RPG/Display file model wouldn't allow a very long field name. Turns out, they don't care! Use a long action name!  \r\n\r\n    <mdf:DdsRecord Alias=\"HOMEMENU\" FuncKeys=\"F3 03;\" CursorField=\"CAction\" >\r\n        <mdf:DdsCharField Alias=\"CAction\"\r\n            DefaultValue=\"\"\r\n            Length=\"32\"\r\n            Usage=\"Both\"\r\n            VisibleCondition=\"*False\" />\r\n    \r\n        <mdf:DdsCharField Alias=\"CFormat\"\r\n            DefaultValue=\"HOMEMENU\"\r\n            Length=\"10\"\r\n            Protect=\"*True\"\r\n            Usage=\"InputOnly\"\r\n            VisibleCondition=\"*False\" />\r\n    \r\n        <mdf:DdsButton AidKey=\"F3\" Text=\"New Registration\" FieldName=\"REGISTER\" />\r\n        <mdf:DdsButton AidKey=\"F3\" Text=\"Registered - Show Labs\" FieldName=\"RETURNING\"/>\r\n        <mdf:DdsButton AidKey=\"F3\" Text=\"End\" FieldName=\"END\"/>\r\n    </mdf:DdsRecord>    \r\n\r\nThese fields allow the RPG program to easily determine what record format was just read (`CFormat`) and what action was requested (`CAction`) for that format. Notice that the F3 function is simply ignored! The program doesn't need to know, nor does it care, what function key was pressed.  \r\n     \r\n    // Show the first panel.\r\n    ExFmt HomeMenu\r\n    \r\n    DoW CAction <> 'END';\r\n      Select;\r\n        When CFormat = 'HOMEMENU';\r\n          Select;\r\n            When CAction = 'REGISTER';\r\n              // Do logic for 'REGISTER' action.\r\n            When CAction = 'RETURNING';\r\n             // Do Logic for 'RETURNING' action.\r\n          EndSl;\r\n      EndSl;            \r\n    EndDo;\r\n    \r\n    *INLR = *On;\r\n    Return;\r\n\r\nWhen you look at the production, you'll notice that's program logic select statement is much larger; however is it doing exactly what the simple example shows above. \r\n\r\nMy goal was to write the logic linking the UI to the RPG program without any function keys, response indicators, or using the INFDS. I succeeded everywhere but with buttons inside subfiles. There, you'll notice as you're reading the programs real code I did have to resort to using a response indicator.\r\n\r\n\r\n\r\n> To be continued \r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}